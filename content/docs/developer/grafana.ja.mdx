---
title: Grafana 連携
description: Grafana のアラートを Echobell と連携してインスタント通知を受け取る方法を学びましょう
---

import { Step, Steps } from "fumadocs-ui/components/steps";

# Grafana 連携

Grafana は人気のオープンソース分析・監視ソリューションです。Grafana と Echobell を連携することで、メトリクスがアラートをトリガーした際にすぐに通知を受け取ることができます。このガイドでは、Grafana アラートと Echobell のセットアップ方法について説明します。

## 前提条件

- 少なくとも 1 つのチャンネルが作成された Echobell アカウント
- Grafana インスタンスへのアクセス（バージョン 8.0 以降）
- Grafana でアラート通知を設定する管理者権限

## セットアップの概要

1. Echobell チャンネルの作成
2. 通知テンプレートの設定
3. webhook URL の取得
4. Grafana コンタクトポイントの設定
5. Grafana でのアラートルールの作成

## ステップバイステップガイド

<Steps>
<Step>
### Echobell チャンネルの作成

1. Echobell アプリを開く
2. 新しいチャンネルを作成（例：「Grafana アラート」）
3. 識別しやすい色を選択
</Step>
<Step>

### 通知テンプレートの設定

Grafana アラートを効果的にフォーマットするテンプレートを設定します：

**タイトルテンプレート:**

```
{{alertName}} - {{status}}
```

**本文テンプレート:**

```
🔔 アラート: {{alertName}}
📊 メトリクス: {{metric}}
📈 値: {{value}}
⏰ 時刻: {{time}}
ℹ️ メッセージ: {{message}}
```

これらのテンプレートは Grafana のアラートペイロード構造と連携します。

</Step>
<Step>
### Webhook URL の取得

1. チャンネル設定で、**トリガー**セクションを探す
2. 提供された webhook URL をコピー
3. この URL は Grafana の設定で使用するため、安全に保管
</Step>
<Step>

### Grafana コンタクトポイントの設定

1. Grafana で、**アラート設定** → **コンタクトポイント**に移動
2. **新規コンタクトポイント**をクリック
3. 以下を設定：
   - 名前：「Echobell」
   - タイプ：「Webhook」
   - URL：Echobell の webhook URL
   - HTTP メソッド：POST
   - コンテンツタイプ：application/json
4. メッセージテンプレートを設定：

```json
{
  "alertName": "{{ .alertName }}",
  "status": "{{ .status }}",
  "metric": "{{ .metric }}",
  "value": "{{ .value }}",
  "time": "{{ .time }}",
  "message": "{{ .message }}",
  "externalLink": "{{ .dashboardURL }}"
}
```

</Step>
<Step>
### アラートルールの作成

1. **アラート設定** → **アラートルール**に移動
2. 新しいアラートルールを作成または既存のものを編集
3. ルール設定で：
   - メトリクスに適切な条件を設定
   - 「Echobell」コンタクトポイントを選択
   - アラート評価基準を設定
</Step>
</Steps>

## 連携のテスト

セットアップの確認：

1. すぐにトリガーされる条件でテストアラートルールを作成
2. 条件が満たされるまで待機
3. Echobell アプリでアラート通知を確認
4. すべてのアラート変数が正しく表示されているか確認
5. 通知をクリックして、リンクされた Grafana ダッシュボードにアクセス

## アラート通知タイプ

Grafana アラートチャンネルを購読する際、以下の重要な通知タイプを設定：

- **時間重要**を緊急システムアラートや緊急通知に使用
- **通話**を重大な障害、重要なしきい値超過、または緊急アラートに使用
- **通常**を標準的な情報アラートと定期通知に使用

## アラート管理のベストプラクティス

1. **アラートテンプレートの整理**

   - アラートテンプレートを明確で一貫性のあるものに
   - 重要なメトリクス情報を含める
   - 通知内の数値とタイムスタンプに適切な書式を使用
   - 緊急アラートは明確に区別できる形式に

2. **重要アラートの設定**

   - 通知疲れを避けるため適切なアラートしきい値を設定
   - 意味のある緊急アラート名を使用
   - 重要なアラートメッセージに十分なコンテキストを含める
   - 異なるタイプの通知に優先度レベルを設定

3. **アラートセキュリティ**

   - webhook URL を安全に保管
   - アラート設定を定期的に監査
   - webhook 配信状態を監視

## トラブルシューティング

アラートを受信できない場合：

1. webhook URL が正しくコピーされているか確認
2. チャンネルがアクティブか確認
3. アクティブな購読者がいるか確認
4. Grafana のコンタクトポイント設定を確認
5. Grafana のアラートルール設定を確認
6. Grafana のアラート履歴を確認

## プライバシーとデータ取り扱い

Echobell のプライバシーファーストなアプローチ：

- アラートコンテンツはデバイスにローカル保存
- サーバーには必要な設定データのみ保存
- webhook URL は機密情報として扱う
- Echobell サーバーにアラートデータは保持されない

## 追加リソース

- [Grafana アラート設定ドキュメント](https://grafana.com/docs/grafana/latest/alerting/)
- [Echobell Webhook 連携](/ja/docs/webhook)
- [通知テンプレートガイド](/ja/docs/notification)
- [サポートセンター](/ja/docs/support)
