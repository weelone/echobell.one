---
title: Integraci√≥n con Home Assistant
description: Gu√≠a completa para integrar Echobell con Home Assistant para notificaciones y alertas instant√°neas de hogar inteligente
---

# Integraci√≥n con Home Assistant

[Home Assistant](https://www.home-assistant.io/) es una potente plataforma de automatizaci√≥n del hogar de c√≥digo abierto que prioriza el control local y la privacidad. Al integrar Echobell con Home Assistant, puedes recibir notificaciones instant√°neas e incluso llamadas telef√≥nicas cuando ocurren eventos importantes en tu hogar inteligente, ya sea una alerta de seguridad, una brecha en el umbral de temperatura o un disparador de automatizaci√≥n.

Esta gu√≠a te explicar√° c√≥mo configurar Echobell para recibir notificaciones de tus automatizaciones de Home Assistant utilizando webhooks o el servicio de notificaci√≥n RESTful.

## Requisitos Previos

Antes de comenzar, aseg√∫rate de tener:

- La [aplicaci√≥n Echobell](https://apps.apple.com/app/id6743597198) instalada en tu dispositivo iOS
- Un canal de Echobell activo (crea uno en la aplicaci√≥n si a√∫n no lo has hecho)
- Una instancia de Home Assistant en funcionamiento (se recomienda la versi√≥n 2023.1 o posterior)
- Acceso a tu configuraci√≥n de Home Assistant

## M√©todo 1: Usando Disparadores Webhook (Recomendado)

El m√©todo webhook es el enfoque m√°s flexible, permiti√©ndote enviar datos personalizados y utilizar [variables de plantilla](/docs/template) en tus notificaciones.

### Paso 1: Obt√©n tu URL de Webhook de Echobell

1. Abre la aplicaci√≥n Echobell y navega a tu canal
2. Toca en el canal para ver los detalles
3. Encuentra la **URL del Webhook** en la secci√≥n de Disparadores (Triggers)
4. Copia la URL; se ver√° as√≠: `https://hook.echobell.one/t/TU_TOKEN`

### Paso 2: Crea una Automatizaci√≥n en Home Assistant

En Home Assistant, puedes activar notificaciones de Echobell utilizando el servicio `rest_command`. Primero, a√±ade el comando REST a tu `configuration.yaml`:

```yaml
rest_command:
  echobell_notify:
    url: "https://hook.echobell.one/t/YOUR_TOKEN"
    method: POST
    content_type: "application/json"
    payload: '{"title": "{{ title }}", "message": "{{ message }}"}'
```

Reemplaza `YOUR_TOKEN` con tu token real de webhook de Echobell.

Despu√©s de a√±adir esto, reinicia Home Assistant para cargar la nueva configuraci√≥n.

### Paso 3: Uso en Automatizaciones

Ahora puedes llamar a este servicio desde cualquier automatizaci√≥n. Aqu√≠ tienes un ejemplo que te notifica cuando se abre una puerta:

```yaml
automation:
  - alias: "Door Open Alert"
    trigger:
      - platform: state
        entity_id: binary_sensor.front_door
        to: "on"
    action:
      - service: rest_command.echobell_notify
        data:
          title: "Security Alert"
          message: "Front door opened at {{ now().strftime('%H:%M') }}"
```

### Paso 4: Configura las Plantillas de Notificaci√≥n

En la configuraci√≥n de tu canal de Echobell, configura las plantillas de notificaci√≥n para mostrar los datos del webhook:

- **Plantilla de t√≠tulo**: `{{title}}`
- **Plantilla de cuerpo**: `{{message}}`

Ahora, cuando la automatizaci√≥n se active, recibir√°s una notificaci√≥n con el t√≠tulo y mensaje personalizados.

## M√©todo 2: Usando la Plataforma de Notificaci√≥n RESTful

Para un enfoque m√°s integrado, puedes configurar Echobell como un servicio de notificaci√≥n en Home Assistant.

### Configuraci√≥n

A√±ade lo siguiente a tu `configuration.yaml`:

```yaml
notify:
  - name: echobell
    platform: rest
    resource: https://hook.echobell.one/t/YOUR_TOKEN
    method: POST_JSON
    data:
      title: "{{ title }}"
      message: "{{ message }}"
```

Reemplaza `YOUR_TOKEN` con tu token de webhook de Echobell, luego reinicia Home Assistant.

### Usando el Servicio de Notificaci√≥n

Ahora puedes usar Echobell como cualquier otro servicio de notificaci√≥n:

```yaml
automation:
  - alias: "Low Battery Alert"
    trigger:
      - platform: numeric_state
        entity_id: sensor.phone_battery
        below: 20
    action:
      - service: notify.echobell
        data:
          title: "Low Battery Warning"
          message: "Phone battery is at {{ states('sensor.phone_battery') }}%"
```

## Casos de Uso Avanzados

### Monitoreo de Temperatura con Alertas Cr√≠ticas

Usa [tipos de notificaci√≥n](/docs/notification) para enviar alertas de temperatura cr√≠ticas como llamadas:

```yaml
rest_command:
  echobell_critical:
    url: "https://hook.echobell.one/t/YOUR_TOKEN"
    method: POST
    content_type: "application/json"
    payload: '{"temperature": "{{ temperature }}", "location": "{{ location }}", "severity": "critical"}'
```

En tu canal de Echobell, establece el [tipo de notificaci√≥n](/docs/notification) en "Calling" (Llamada) y usa esta plantilla:

- **T√≠tulo**: `Critical Temperature Alert`
- **Cuerpo**: `{{location}} temperature is {{temperature}}¬∞C - Immediate attention required!`

### Integraci√≥n con Sistema de Seguridad

Configura un monitoreo de seguridad completo:

```yaml
automation:
  - alias: "Security Breach Detection"
    trigger:
      - platform: state
        entity_id:
          - binary_sensor.motion_detector_1
          - binary_sensor.motion_detector_2
          - binary_sensor.window_sensor
        to: "on"
    condition:
      - condition: state
        entity_id: alarm_control_panel.home_alarm
        state: "armed_away"
    action:
      - service: rest_command.echobell_notify
        data:
          title: "üö® Security Alert"
          message: "{{ trigger.to_state.attributes.friendly_name }} detected activity while system armed"
          sensor: "{{ trigger.entity_id }}"
          timestamp: "{{ now().isoformat() }}"
```

### Notificaciones de Electrodom√©sticos Inteligentes

Monitorea los ciclos de los electrodom√©sticos y recibe notificaciones cuando terminen:

```yaml
automation:
  - alias: "Washing Machine Complete"
    trigger:
      - platform: state
        entity_id: sensor.washing_machine_power
        to: "0"
        for:
          minutes: 3
    action:
      - service: notify.echobell
        data:
          title: "Washing Machine Done"
          message: "Your laundry is ready to be moved to the dryer"
```

### Monitoreo Ambiental

Rastrea la calidad del aire, la humedad u otros factores ambientales:

```yaml
automation:
  - alias: "High CO2 Alert"
    trigger:
      - platform: numeric_state
        entity_id: sensor.living_room_co2
        above: 1000
    action:
      - service: rest_command.echobell_notify
        data:
          title: "Air Quality Warning"
          message: "CO2 level in living room is {{ states('sensor.living_room_co2') }} ppm. Consider ventilating."
```

## Uso de Condiciones para Filtrado Inteligente

Puedes usar [condiciones de Echobell](/docs/conditions) para filtrar notificaciones basadas en criterios espec√≠ficos. Por ejemplo, notificar solo durante ciertas horas o cuando los valores superan los umbrales:

Establece una condici√≥n en tu canal de Echobell:
```
severity == "critical" || (hour >= 22 || hour <= 7)
```

Esto solo env√≠a notificaciones si la gravedad es cr√≠tica O si es de noche (de 10 PM a 7 AM).

En tu automatizaci√≥n de Home Assistant, incluye los datos relevantes:

```yaml
action:
  - service: rest_command.echobell_notify
    data:
      title: "Temperature Alert"
      message: "Freezer temperature: {{ states('sensor.freezer_temp') }}¬∞C"
      severity: "{% if states('sensor.freezer_temp') | float > -10 %}critical{% else %}normal{% endif %}"
      hour: "{{ now().hour }}"
```

## Env√≠o de Datos de Sensores

Puedes pasar cualquier dato de sensor de Home Assistant a tus notificaciones de Echobell:

```yaml
rest_command:
  echobell_sensor_update:
    url: "https://hook.echobell.one/t/YOUR_TOKEN"
    method: POST
    content_type: "application/json"
    payload: >
      {
        "sensor_name": "{{ sensor_name }}",
        "current_value": "{{ current_value }}",
        "unit": "{{ unit }}",
        "state": "{{ state }}",
        "timestamp": "{{ timestamp }}"
      }
```

## Manejo de Encabezados HTTP

Echobell puede acceder a los encabezados HTTP de las solicitudes webhook. Esto es √∫til para autenticaci√≥n o seguimiento:

```yaml
rest_command:
  echobell_with_headers:
    url: "https://hook.echobell.one/t/YOUR_TOKEN"
    method: POST
    headers:
      X-Home-Assistant-Instance: "{{ instance_name }}"
      X-Automation-ID: "{{ automation_id }}"
    content_type: "application/json"
    payload: '{"message": "{{ message }}"}'
```

En tu plantilla de Echobell, accede a los encabezados con:
```
{{header["x-home-assistant-instance"]}}
```

## Depuraci√≥n y Pruebas

### Prueba tu Webhook

Usa las Herramientas de Desarrollador ‚Üí Servicios de Home Assistant para probar tu configuraci√≥n:

1. Selecciona `rest_command.echobell_notify`
2. Introduce datos de prueba:
```yaml
title: "Test Notification"
message: "This is a test from Home Assistant"
```
3. Haz clic en "Llamar servicio" (Call Service)
4. Revisa tu aplicaci√≥n Echobell para ver la notificaci√≥n

### Revisa los Registros de Home Assistant

Si las notificaciones no llegan, revisa los registros de Home Assistant:

```bash
# En Home Assistant, ve a:
Ajustes ‚Üí Sistema ‚Üí Registros

# O revisa el archivo de registro:
config/home-assistant.log
```

Busca errores relacionados con `rest_command` o solicitudes HTTP a `hook.echobell.one`.

### Verifica la URL del Webhook

Aseg√∫rate de que tu URL de webhook sea correcta:
- Debe comenzar con `https://hook.echobell.one/t/`
- El token debe estar incluido
- Sin espacios ni caracteres extra

## Consideraciones de Rendimiento

### Limitaci√≥n de Tasa (Rate Limiting)

Los webhooks de Echobell est√°n sujetos a limitaci√≥n de tasa para prevenir abusos. Para sensores de alta frecuencia:

- Evita activar en cada actualizaci√≥n del sensor
- Usa `for` en los disparadores para evitar rebotes (debounce):
```yaml
trigger:
  - platform: numeric_state
    entity_id: sensor.temperature
    above: 30
    for:
      minutes: 5  # Solo activar despu√©s de 5 minutos por encima del umbral
```

### Agrupaci√≥n de Actualizaciones

Para m√∫ltiples eventos relacionados, considera agruparlos en una sola notificaci√≥n:

```yaml
automation:
  - alias: "Daily Home Summary"
    trigger:
      - platform: time
        at: "09:00:00"
    action:
      - service: rest_command.echobell_notify
        data:
          title: "Morning Home Summary"
          message: >
            Temperature: {{ states('sensor.temperature') }}¬∞C
            Humidity: {{ states('sensor.humidity') }}%
            Energy today: {{ states('sensor.daily_energy') }} kWh
            Windows open: {{ expand(states.binary_sensor) | selectattr('state', 'eq', 'on') | selectattr('attributes.device_class', 'eq', 'window') | list | count }}
```

## Mejores Pr√°cticas de Seguridad

### Protege tu URL de Webhook

- Nunca publiques URLs de webhook en repositorios p√∫blicos
- Usa secretos de Home Assistant para datos sensibles
- Rota los tokens de webhook peri√≥dicamente

Usando secretos en `configuration.yaml`:

```yaml
# secrets.yaml
echobell_webhook: "https://hook.echobell.one/t/YOUR_TOKEN"

# configuration.yaml
rest_command:
  echobell_notify:
    url: !secret echobell_webhook
    method: POST
    content_type: "application/json"
    payload: '{"title": "{{ title }}", "message": "{{ message }}"}'
```

### Limita la Informaci√≥n Sensible

Ten cuidado con los datos que incluyes en las notificaciones:

```yaml
# Bien - Informaci√≥n general
message: "Motion detected in living room"

# Evitar - Detalles sensibles
message: "Security code: 1234, camera feed: http://..."
```

## Soluci√≥n de Problemas Comunes

### Las Notificaciones No Llegan

1. **Verifica la conectividad de red**: Aseg√∫rate de que tu instancia de Home Assistant pueda acceder a internet
2. **Verifica la URL del webhook**: Copia y p√©gala con cuidado, incluyendo el token
3. **Revisa la aplicaci√≥n Echobell**: Aseg√∫rate de estar suscrito al canal
4. **Revisa los registros de Home Assistant**: Busca errores HTTP o tiempos de espera agotados

### Errores de Plantilla

Si las plantillas no se renderizan correctamente:

1. Prueba las plantillas en Herramientas de Desarrollador ‚Üí Plantilla
2. Aseg√∫rate de que los nombres de las variables coincidan entre Home Assistant y Echobell
3. Revisa errores tipogr√°ficos en la sintaxis de la plantilla: `{{variable}}` no `{{ variable}}`

### La Automatizaci√≥n No Se Activa

1. Verifica las condiciones de activaci√≥n en Home Assistant
2. Prueba la automatizaci√≥n manualmente desde Herramientas de Desarrollador
3. Revisa que los estados de la entidad coincidan con tu configuraci√≥n de activaci√≥n
4. Revisa los rastros de automatizaci√≥n para depurar

## Ejemplo: Configuraci√≥n Completa de Sistema de Seguridad

Aqu√≠ tienes un ejemplo completo integrando m√∫ltiples sensores de seguridad:

```yaml
# configuration.yaml
rest_command:
  echobell_security:
    url: !secret echobell_security_webhook
    method: POST
    content_type: "application/json"
    payload: >
      {
        "event_type": "{{ event_type }}",
        "location": "{{ location }}",
        "sensor": "{{ sensor }}",
        "timestamp": "{{ timestamp }}",
        "alarm_state": "{{ alarm_state }}"
      }

# automations.yaml
- alias: "Security Event Handler"
  trigger:
    - platform: state
      entity_id:
        - binary_sensor.front_door
        - binary_sensor.back_door
        - binary_sensor.garage_door
        - binary_sensor.motion_hallway
        - binary_sensor.motion_living_room
      to: "on"
  action:
    - service: rest_command.echobell_security
      data:
        event_type: "{{ 'door' if 'door' in trigger.entity_id else 'motion' }}"
        location: "{{ trigger.to_state.attributes.friendly_name }}"
        sensor: "{{ trigger.entity_id }}"
        timestamp: "{{ now().strftime('%Y-%m-%d %H:%M:%S') }}"
        alarm_state: "{{ states('alarm_control_panel.home_alarm') }}"
```

En Echobell, configura tus plantillas:
- **T√≠tulo**: `Security Alert: {{event_type | upper}}`
- **Cuerpo**: `{{location}} activated at {{timestamp}} (Alarm: {{alarm_state}})`

## Pr√≥ximos Pasos

Ahora que tienes Echobell integrado con Home Assistant:

- Explora los [tipos de notificaci√≥n](/docs/notification) para diferentes prioridades de alerta
- Aprende sobre [condiciones](/docs/conditions) para filtrar notificaciones inteligentemente
- Revisa las [variables de plantilla](/docs/template) para formato de mensajes avanzado
- Lee sobre [mejores pr√°cticas de webhook](/docs/webhook) para una integraci√≥n √≥ptima

## Recursos Relacionados

- [Documentaci√≥n de Comandos REST de Home Assistant](https://www.home-assistant.io/integrations/rest_command/)
- [Plataforma de Notificaci√≥n RESTful de Home Assistant](https://www.home-assistant.io/integrations/notify.rest/)
- [Documentaci√≥n de Webhook de Echobell](/docs/webhook)
- [Sistema de Plantillas de Echobell](/docs/template)
