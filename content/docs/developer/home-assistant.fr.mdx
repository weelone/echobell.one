---
title: Int√©gration Home Assistant
description: Guide complet pour int√©grer Echobell avec Home Assistant pour des notifications et alertes instantan√©es de maison intelligente
---

# Int√©gration Home Assistant

[Home Assistant](https://www.home-assistant.io/) est une puissante plateforme domotique open-source qui privil√©gie le contr√¥le local et la confidentialit√©. En int√©grant Echobell avec Home Assistant, vous pouvez recevoir des notifications instantan√©es et m√™me des appels t√©l√©phoniques lorsque des √©v√©nements importants se produisent dans votre maison intelligente, qu'il s'agisse d'une alerte de s√©curit√©, d'un d√©passement de seuil de temp√©rature ou d'un d√©clencheur d'automatisation.

Ce guide vous expliquera comment configurer Echobell pour recevoir des notifications de vos automatisations Home Assistant en utilisant des webhooks ou le service de notification RESTful.

## Pr√©requis

Avant de commencer, assurez-vous d'avoir :

- L'[application Echobell](https://apps.apple.com/app/id6743597198) install√©e sur votre appareil iOS
- Un canal Echobell actif (cr√©ez-en un dans l'application si ce n'est pas d√©j√† fait)
- Une instance Home Assistant en cours d'ex√©cution (version 2023.1 ou ult√©rieure recommand√©e)
- Acc√®s √† votre configuration Home Assistant

## M√©thode 1 : Utilisation des d√©clencheurs Webhook (Recommand√©)

La m√©thode webhook est l'approche la plus flexible, vous permettant d'envoyer des donn√©es personnalis√©es et d'utiliser des [variables de mod√®le](/docs/template) dans vos notifications.

### √âtape 1 : Obtenir votre URL de Webhook Echobell

1. Ouvrez l'application Echobell et acc√©dez √† votre canal
2. Appuyez sur le canal pour voir les d√©tails
3. Trouvez l'**URL du Webhook** dans la section D√©clencheurs (Triggers)
4. Copiez l'URL ‚Äî elle ressemblera √† : `https://hook.echobell.one/t/VOTRE_TOKEN`

### √âtape 2 : Cr√©er une automatisation Home Assistant

Dans Home Assistant, vous pouvez d√©clencher des notifications Echobell en utilisant le service `rest_command`. Tout d'abord, ajoutez la commande REST √† votre `configuration.yaml` :

```yaml
rest_command:
  echobell_notify:
    url: "https://hook.echobell.one/t/YOUR_TOKEN"
    method: POST
    content_type: "application/json"
    payload: '{"title": "{{ title }}", "message": "{{ message }}"}'
```

Remplacez `YOUR_TOKEN` par votre v√©ritable jeton de webhook Echobell.

Apr√®s avoir ajout√© ceci, red√©marrez Home Assistant pour charger la nouvelle configuration.

### √âtape 3 : Utilisation dans les automatisations

Maintenant, vous pouvez appeler ce service depuis n'importe quelle automatisation. Voici un exemple qui vous notifie lorsqu'une porte s'ouvre :

```yaml
automation:
  - alias: "Door Open Alert"
    trigger:
      - platform: state
        entity_id: binary_sensor.front_door
        to: "on"
    action:
      - service: rest_command.echobell_notify
        data:
          title: "Security Alert"
          message: "Front door opened at {{ now().strftime('%H:%M') }}"
```

### √âtape 4 : Configurer les mod√®les de notification

Dans les param√®tres de votre canal Echobell, configurez les mod√®les de notification pour afficher les donn√©es du webhook :

- **Mod√®le de titre** : `{{title}}`
- **Mod√®le de corps** : `{{message}}`

D√©sormais, lorsque l'automatisation se d√©clenche, vous recevrez une notification avec le titre et le message personnalis√©s.

## M√©thode 2 : Utilisation de la plateforme de notification RESTful

Pour une approche plus int√©gr√©e, vous pouvez configurer Echobell comme un service de notification dans Home Assistant.

### Configuration

Ajoutez ce qui suit √† votre `configuration.yaml` :

```yaml
notify:
  - name: echobell
    platform: rest
    resource: https://hook.echobell.one/t/YOUR_TOKEN
    method: POST_JSON
    data:
      title: "{{ title }}"
      message: "{{ message }}"
```

Remplacez `YOUR_TOKEN` par votre jeton de webhook Echobell, puis red√©marrez Home Assistant.

### Utilisation du service de notification

Vous pouvez maintenant utiliser Echobell comme n'importe quel autre service de notification :

```yaml
automation:
  - alias: "Low Battery Alert"
    trigger:
      - platform: numeric_state
        entity_id: sensor.phone_battery
        below: 20
    action:
      - service: notify.echobell
        data:
          title: "Low Battery Warning"
          message: "Phone battery is at {{ states('sensor.phone_battery') }}%"
```

## Cas d'utilisation avanc√©s

### Surveillance de la temp√©rature avec alertes critiques

Utilisez les [types de notification](/docs/notification) pour envoyer des alertes de temp√©rature critiques sous forme d'appels :

```yaml
rest_command:
  echobell_critical:
    url: "https://hook.echobell.one/t/YOUR_TOKEN"
    method: POST
    content_type: "application/json"
    payload: '{"temperature": "{{ temperature }}", "location": "{{ location }}", "severity": "critical"}'
```

Dans votre canal Echobell, d√©finissez le [type de notification](/docs/notification) sur "Calling" (Appel) et utilisez ce mod√®le :

- **Titre** : `Critical Temperature Alert`
- **Corps** : `{{location}} temperature is {{temperature}}¬∞C - Immediate attention required!`

### Int√©gration du syst√®me de s√©curit√©

Mettez en place une surveillance de s√©curit√© compl√®te :

```yaml
automation:
  - alias: "Security Breach Detection"
    trigger:
      - platform: state
        entity_id:
          - binary_sensor.motion_detector_1
          - binary_sensor.motion_detector_2
          - binary_sensor.window_sensor
        to: "on"
    condition:
      - condition: state
        entity_id: alarm_control_panel.home_alarm
        state: "armed_away"
    action:
      - service: rest_command.echobell_notify
        data:
          title: "üö® Security Alert"
          message: "{{ trigger.to_state.attributes.friendly_name }} detected activity while system armed"
          sensor: "{{ trigger.entity_id }}"
          timestamp: "{{ now().isoformat() }}"
```

### Notifications d'appareils √©lectrom√©nagers intelligents

Surveillez les cycles des appareils et soyez notifi√© lorsqu'ils sont termin√©s :

```yaml
automation:
  - alias: "Washing Machine Complete"
    trigger:
      - platform: state
        entity_id: sensor.washing_machine_power
        to: "0"
        for:
          minutes: 3
    action:
      - service: notify.echobell
        data:
          title: "Washing Machine Done"
          message: "Your laundry is ready to be moved to the dryer"
```

### Surveillance environnementale

Suivez la qualit√© de l'air, l'humidit√© ou d'autres facteurs environnementaux :

```yaml
automation:
  - alias: "High CO2 Alert"
    trigger:
      - platform: numeric_state
        entity_id: sensor.living_room_co2
        above: 1000
    action:
      - service: rest_command.echobell_notify
        data:
          title: "Air Quality Warning"
          message: "CO2 level in living room is {{ states('sensor.living_room_co2') }} ppm. Consider ventilating."
```

## Utilisation de conditions pour un filtrage intelligent

Vous pouvez utiliser les [conditions Echobell](/docs/conditions) pour filtrer les notifications en fonction de crit√®res sp√©cifiques. Par exemple, ne notifier que pendant certaines heures ou lorsque les valeurs d√©passent des seuils :

D√©finissez une condition dans votre canal Echobell :
```
severity == "critical" || (hour >= 22 || hour <= 7)
```

Cela n'envoie des notifications que si la gravit√© est critique OU s'il fait nuit (de 22h √† 7h).

Dans votre automatisation Home Assistant, incluez les donn√©es pertinentes :

```yaml
action:
  - service: rest_command.echobell_notify
    data:
      title: "Temperature Alert"
      message: "Freezer temperature: {{ states('sensor.freezer_temp') }}¬∞C"
      severity: "{% if states('sensor.freezer_temp') | float > -10 %}critical{% else %}normal{% endif %}"
      hour: "{{ now().hour }}"
```

## Envoi de donn√©es de capteurs

Vous pouvez transmettre n'importe quelle donn√©e de capteur Home Assistant √† vos notifications Echobell :

```yaml
rest_command:
  echobell_sensor_update:
    url: "https://hook.echobell.one/t/YOUR_TOKEN"
    method: POST
    content_type: "application/json"
    payload: >
      {
        "sensor_name": "{{ sensor_name }}",
        "current_value": "{{ current_value }}",
        "unit": "{{ unit }}",
        "state": "{{ state }}",
        "timestamp": "{{ timestamp }}"
      }
```

## Gestion des en-t√™tes HTTP

Echobell peut acc√©der aux en-t√™tes HTTP des requ√™tes webhook. C'est utile pour l'authentification ou le suivi :

```yaml
rest_command:
  echobell_with_headers:
    url: "https://hook.echobell.one/t/YOUR_TOKEN"
    method: POST
    headers:
      X-Home-Assistant-Instance: "{{ instance_name }}"
      X-Automation-ID: "{{ automation_id }}"
    content_type: "application/json"
    payload: '{"message": "{{ message }}"}'
```

Dans votre mod√®le Echobell, acc√©dez aux en-t√™tes avec :
```
{{header["x-home-assistant-instance"]}}
```

## D√©bogage et tests

### Tester votre Webhook

Utilisez les Outils de d√©veloppement ‚Üí Services de Home Assistant pour tester votre configuration :

1. S√©lectionnez `rest_command.echobell_notify`
2. Entrez les donn√©es de test :
```yaml
title: "Test Notification"
message: "This is a test from Home Assistant"
```
3. Cliquez sur "Appeler le service"
4. V√©rifiez votre application Echobell pour la notification

### V√©rifier les journaux Home Assistant

Si les notifications n'arrivent pas, v√©rifiez les journaux de Home Assistant :

```bash
# Dans Home Assistant, allez √† :
Param√®tres ‚Üí Syst√®me ‚Üí Journaux

# Ou v√©rifiez le fichier journal :
config/home-assistant.log
```

Recherchez des erreurs li√©es √† `rest_command` ou aux requ√™tes HTTP vers `hook.echobell.one`.

### V√©rifier l'URL du Webhook

Assurez-vous que votre URL de webhook est correcte :
- Elle doit commencer par `https://hook.echobell.one/t/`
- Le jeton doit √™tre inclus
- Pas d'espaces ou de caract√®res suppl√©mentaires

## Consid√©rations de performance

### Limitation de d√©bit

Les webhooks Echobell sont soumis √† une limitation de d√©bit pour √©viter les abus. Pour les capteurs √† haute fr√©quence :

- √âvitez de d√©clencher √† chaque mise √† jour du capteur
- Utilisez `for` dans les d√©clencheurs pour temporiser :
```yaml
trigger:
  - platform: numeric_state
    entity_id: sensor.temperature
    above: 30
    for:
      minutes: 5  # Only trigger after 5 minutes above threshold
```

### Regroupement des mises √† jour

Pour plusieurs √©v√©nements li√©s, envisagez de les regrouper en une seule notification :

```yaml
automation:
  - alias: "Daily Home Summary"
    trigger:
      - platform: time
        at: "09:00:00"
    action:
      - service: rest_command.echobell_notify
        data:
          title: "Morning Home Summary"
          message: >
            Temperature: {{ states('sensor.temperature') }}¬∞C
            Humidity: {{ states('sensor.humidity') }}%
            Energy today: {{ states('sensor.daily_energy') }} kWh
            Windows open: {{ expand(states.binary_sensor) | selectattr('state', 'eq', 'on') | selectattr('attributes.device_class', 'eq', 'window') | list | count }}
```

## Bonnes pratiques de s√©curit√©

### Prot√©gez votre URL de Webhook

- Ne committez jamais d'URL de webhook dans des d√©p√¥ts publics
- Utilisez les secrets Home Assistant pour les donn√©es sensibles
- Faites tourner les jetons de webhook p√©riodiquement

Utilisation des secrets dans `configuration.yaml` :

```yaml
# secrets.yaml
echobell_webhook: "https://hook.echobell.one/t/YOUR_TOKEN"

# configuration.yaml
rest_command:
  echobell_notify:
    url: !secret echobell_webhook
    method: POST
    content_type: "application/json"
    payload: '{"title": "{{ title }}", "message": "{{ message }}"}'
```

### Limiter les informations sensibles

Soyez prudent quant aux donn√©es que vous incluez dans les notifications :

```yaml
# Good - General information
message: "Motion detected in living room"

# Avoid - Sensitive details
message: "Security code: 1234, camera feed: http://..."
```

## D√©pannage des probl√®mes courants

### Les notifications n'arrivent pas

1. **V√©rifiez la connectivit√© r√©seau** : Assurez-vous que votre instance Home Assistant peut acc√©der √† Internet
2. **V√©rifiez l'URL du webhook** : Copiez-la et collez-la soigneusement, en incluant le jeton
3. **V√©rifiez l'application Echobell** : Assurez-vous d'√™tre abonn√© au canal
4. **Examinez les journaux Home Assistant** : Recherchez des erreurs HTTP ou des d√©lais d'attente

### Erreurs de mod√®le

Si les mod√®les ne s'affichent pas correctement :

1. Testez les mod√®les dans Outils de d√©veloppement ‚Üí Mod√®le
2. Assurez-vous que les noms de variables correspondent entre Home Assistant et Echobell
3. V√©rifiez les fautes de frappe dans la syntaxe du mod√®le : `{{variable}}` et non `{{ variable}}`

### L'automatisation ne se d√©clenche pas

1. V√©rifiez les conditions de d√©clenchement dans Home Assistant
2. Testez l'automatisation manuellement depuis les Outils de d√©veloppement
3. V√©rifiez que les √©tats des entit√©s correspondent √† votre configuration de d√©clenchement
4. Examinez les traces d'automatisation pour le d√©bogage

## Exemple : Configuration compl√®te du syst√®me de s√©curit√©

Voici un exemple complet int√©grant plusieurs capteurs de s√©curit√© :

```yaml
# configuration.yaml
rest_command:
  echobell_security:
    url: !secret echobell_security_webhook
    method: POST
    content_type: "application/json"
    payload: >
      {
        "event_type": "{{ event_type }}",
        "location": "{{ location }}",
        "sensor": "{{ sensor }}",
        "timestamp": "{{ timestamp }}",
        "alarm_state": "{{ alarm_state }}"
      }

# automations.yaml
- alias: "Security Event Handler"
  trigger:
    - platform: state
      entity_id:
        - binary_sensor.front_door
        - binary_sensor.back_door
        - binary_sensor.garage_door
        - binary_sensor.motion_hallway
        - binary_sensor.motion_living_room
      to: "on"
  action:
    - service: rest_command.echobell_security
      data:
        event_type: "{{ 'door' if 'door' in trigger.entity_id else 'motion' }}"
        location: "{{ trigger.to_state.attributes.friendly_name }}"
        sensor: "{{ trigger.entity_id }}"
        timestamp: "{{ now().strftime('%Y-%m-%d %H:%M:%S') }}"
        alarm_state: "{{ states('alarm_control_panel.home_alarm') }}"
```

Dans Echobell, d√©finissez vos mod√®les :
- **Titre** : `Security Alert: {{event_type | upper}}`
- **Corps** : `{{location}} activated at {{timestamp}} (Alarm: {{alarm_state}})`

## Prochaines √©tapes

Maintenant que vous avez int√©gr√© Echobell avec Home Assistant :

- Explorez les [types de notification](/docs/notification) pour diff√©rentes priorit√©s d'alerte
- Apprenez-en plus sur les [conditions](/docs/conditions) pour filtrer les notifications intelligemment
- Consultez les [variables de mod√®le](/docs/template) pour un formatage de message avanc√©
- Lisez les [bonnes pratiques webhook](/docs/webhook) pour une int√©gration optimale

## Ressources associ√©es

- [Documentation des commandes REST Home Assistant](https://www.home-assistant.io/integrations/rest_command/)
- [Plateforme de notification RESTful Home Assistant](https://www.home-assistant.io/integrations/notify.rest/)
- [Documentation Webhook Echobell](/docs/webhook)
- [Syst√®me de mod√®les Echobell](/docs/template)
