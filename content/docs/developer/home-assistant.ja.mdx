---
title: Home Assistant 連携
description: EchobellとHome Assistantを連携し、スマートホームの通知やアラートを即座に受け取るための完全ガイド
---

import { Step, Steps } from "fumadocs-ui/components/steps";

# Home Assistant 連携

[Home Assistant](https://www.home-assistant.io/)は、ローカル制御とプライバシーを第一に考えた強力なオープンソースのホームオートメーションプラットフォームです。Echobell を Home Assistant と連携させることで、セキュリティアラート、温度の閾値超過、オートメーションのトリガーなど、スマートホームで重要なイベントが発生した際に、即座に通知や電話着信を受け取ることができます。

このガイドでは、Webhook または RESTful Notify サービスを使用して、Home Assistant のオートメーションから Echobell の通知を受け取る設定方法を解説します。

## 前提条件

始める前に、以下を確認してください：

- iOS デバイスに[Echobell アプリ](https://apps.apple.com/app/id6743597198)がインストールされていること
- 有効な Echobell チャンネルがあること（まだの場合はアプリで作成してください）
- Home Assistant インスタンスが稼働していること（バージョン 2023.1 以降を推奨）
- Home Assistant の設定へのアクセス権があること

## 方法 1: Webhook トリガーを使用する（推奨）

Webhook を使用する方法は最も柔軟性が高く、カスタムデータの送信や通知内での[テンプレート変数](/docs/template)の使用が可能です。

<Steps>
<Step>
### Echobell Webhook URLの取得

1. Echobell アプリを開き、チャンネルに移動します
2. チャンネルをタップして詳細を表示します
3. Triggers セクションにある **Webhook URL** を探します
4. URL をコピーします。次のようになります：`https://hook.echobell.one/t/YOUR_TOKEN`
</Step>
<Step>

### Home Assistant オートメーションの作成

Home Assistant では、`rest_command`サービスを使用して Echobell 通知をトリガーできます。まず、`configuration.yaml`に REST コマンドを追加します：

```yaml
rest_command:
  echobell_notify:
    url: "https://hook.echobell.one/t/YOUR_TOKEN"
    method: POST
    content_type: "application/json"
    payload: '{"title": "{{ title }}", "message": "{{ message }}"}'
```

`YOUR_TOKEN`を実際の Echobell Webhook トークンに置き換えてください。

追加後、Home Assistant を再起動して新しい設定を読み込みます。

</Step>
<Step>
### オートメーションでの使用

これで、どのオートメーションからでもこのサービスを呼び出すことができます。以下は、ドアが開いたときに通知する例です：

```yaml
automation:
  - alias: "Door Open Alert"
    trigger:
      - platform: state
        entity_id: binary_sensor.front_door
        to: "on"
    action:
      - service: rest_command.echobell_notify
        data:
          title: "Security Alert"
          message: "Front door opened at {{ now().strftime('%H:%M') }}"
```

</Step>
<Step>
### 通知テンプレートの設定

Echobell チャンネルの設定で、Webhook データを表示するように通知テンプレートを設定します：

- **Title template**: `{{title}}`
- **Body template**: `{{message}}`

これで、オートメーションがトリガーされると、カスタムタイトルとメッセージを含む通知が届きます。

</Step>
</Steps>

## 方法 2: RESTful Notify プラットフォームを使用する

より統合されたアプローチとして、Echobell を Home Assistant の通知サービス（notify service）として設定することもできます。

### 設定

`configuration.yaml`に以下を追加します：

```yaml
notify:
  - name: echobell
    platform: rest
    resource: https://hook.echobell.one/t/YOUR_TOKEN
    method: POST_JSON
    data:
      title: "{{ title }}"
      message: "{{ message }}"
```

`YOUR_TOKEN`を Echobell Webhook トークンに置き換え、Home Assistant を再起動してください。

### Notify サービスの使用

これで、Echobell を他の通知サービスと同様に使用できます：

```yaml
automation:
  - alias: "Low Battery Alert"
    trigger:
      - platform: numeric_state
        entity_id: sensor.phone_battery
        below: 20
    action:
      - service: notify.echobell
        data:
          title: "Low Battery Warning"
          message: "Phone battery is at {{ states('sensor.phone_battery') }}%"
```

## 次のステップ

Echobell を Home Assistant と連携できたら：

- [通知タイプ](/docs/notification)で異なるアラート優先度を設定
- [条件](/docs/conditions)で通知をインテリジェントにフィルタリング
- [テンプレート変数](/docs/template)で高度なメッセージフォーマット
- [Webhook ベストプラクティス](/docs/webhook)で最適な連携を実現

## 関連リソース

- [Home Assistant REST Command ドキュメント](https://www.home-assistant.io/integrations/rest_command/)
- [Home Assistant RESTful Notify プラットフォーム](https://www.home-assistant.io/integrations/notify.rest/)
- [Echobell Webhook ドキュメント](/docs/webhook)
- [Echobell テンプレートシステム](/docs/template)
