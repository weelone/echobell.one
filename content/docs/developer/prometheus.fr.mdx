---
title: Int√©gration Prometheus & Alertmanager
description: Configurez Alertmanager pour envoyer des alertes √† Echobell via webhook ou email
---

# Int√©gration Prometheus

Prometheus avec Alertmanager est une pile open source de supervision et d'alerte tr√®s r√©pandue. En l'int√©grant √† Echobell, vous recevez des notifications mobiles instantan√©es (y compris sensibles au temps ou sous forme d'appel) lorsque vos r√®gles d'alerte se d√©clenchent.

## Pr√©requis

- Un compte Echobell avec au moins un canal
- Un Prometheus + Alertmanager op√©rationnel
- L'acc√®s pour modifier la configuration d'Alertmanager (alertmanager.yml)

## Aper√ßu

1. Cr√©er un canal Echobell
2. Configurer les mod√®les de notification (et le Mod√®le de lien optionnel)
3. Choisir une m√©thode d'int√©gration :
   - Webhook via un r√©cepteur webhook Alertmanager (recommand√©)
   - Email via un r√©cepteur email Alertmanager (alternatif)
4. Cr√©er ou mettre √† jour des r√®gles d'alerte
5. Tester et affiner

## Guide d√©taill√©

### 1) Cr√©er un canal Echobell

1. Ouvrir l'application Echobell
2. Cr√©er un canal (ex. "Prometheus Alerts")
3. Choisir une couleur pour l'identifier facilement

### 2) Configurer les mod√®les

La charge utile du webhook Alertmanager comprend des champs comme status, commonLabels, commonAnnotations, externalURL et un tableau alerts. Vous pouvez les r√©f√©rencer directement dans les mod√®les Echobell.

Mod√®les sugg√©r√©s :

Mod√®le de titre :

```
{{commonLabels.alertname}} - {{status}}
```

Mod√®le de corps :

```
üîî Alerte : {{commonLabels.alertname}}
üìä S√©v√©rit√© : {{commonLabels.severity}}
üñ•Ô∏è Instance : {{alerts[0].labels["instance"]}}
‚è∞ D√©but : {{alerts[0].startsAt}}
‚ÑπÔ∏è R√©sum√© : {{commonAnnotations.summary}}
üßæ Description : {{commonAnnotations.description}}
```

Mod√®le de lien (optionnel) :

```
{{alerts[0].generatorURL || externalURL}}
```

Affiche un lien direct vers le graphique ou tableau de bord pertinent. Si generatorURL est absent, externalURL est utilis√©.

### 3) M√©thode A ‚Äî Webhook (recommand√©e)

1. Dans votre canal Echobell, copiez l'URL du webhook depuis Triggers
2. Dans Alertmanager, ajoutez un r√©cepteur webhook qui envoie vers cette URL

Exemple minimal alertmanager.yml :

```yaml
route:
  receiver: echobell-webhook

receivers:
  - name: echobell-webhook
    webhook_configs:
      - url: "https://hook.echobell.one/t/REPLACE_WITH_YOUR_TOKEN"
        send_resolved: true
        http_config:
          follow_redirects: true
```

Notes :

- send_resolved: true enverra aussi lors de la r√©solution de l'alerte
- Echobell lit le JSON tel quel, les mod√®les ci-dessus fonctionneront

### 3 alt) M√©thode B ‚Äî Email (alternative)

Si vous pr√©f√©rez/besoin d'email, utilisez le r√©cepteur email d'Alertmanager et envoyez vers l'adresse li√©e au canal.

1. Dans Echobell, copiez l'adresse email du canal depuis Triggers
2. Configurez un r√©cepteur email dans Alertmanager avec des mod√®les simples

Exemple :

```yaml
receivers:
  - name: echobell-email
    email_configs:
      - to: "COLLEZ_L'ADRESSE_DU_CANAL"
        send_resolved: true
        subject: "{{ .CommonLabels.alertname }} - {{ .Status }}"
        html: |
          <p><strong>R√©sum√© :</strong> {{ .CommonAnnotations.summary }}</p>
          <p>{{ .CommonAnnotations.description }}</p>
          <p>
            <a href='{{ (index .Alerts 0).GeneratorURL }}' target='_blank' rel='noopener'>Ouvrir dans Prometheus</a>
          </p>
```

Dans les mod√®les Echobell pour les d√©clenchements par email, vous pouvez utiliser des variables comme subject, text et html fournies automatiquement.

### 4) R√®gle d'alerte d'exemple

```yaml
groups:
  - name: example
    rules:
      - alert: HighCPU
        expr: avg(rate(process_cpu_seconds_total[5m])) > 0.8
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "Utilisation CPU √©lev√©e"
          description: "La CPU d√©passe 80% depuis 2 minutes"
```

Lorsque l'alerte se d√©clenche, Alertmanager envoie l'√©v√©nement au r√©cepteur configur√© et Echobell notifie les abonn√©s du canal.

## Tests

1. Baissez temporairement les seuils ou cr√©ez une alerte de test
2. V√©rifiez que vous recevez la notification Echobell
3. Si vous utilisez le Mod√®le de lien, ouvrez-le depuis l'enregistrement
4. R√©solvez l'alerte et v√©rifiez la notification de r√©solution

## Types de notification

- Time Sensitive : pannes critiques, incidents n√©cessitant une astreinte
- Calling : interruptions s√©v√®res n√©cessitant de rompre les modes de concentration
- Normal : alertes routini√®res ou informatives

## Bonnes pratiques

1. Des mod√®les concis et informatifs (nom, s√©v√©rit√©, instance, r√©sum√©)
2. Utilisez le Mod√®le de lien pour acc√©der directement au graphique/tableau
3. Groupez et routez les alertes dans Alertmanager pour r√©duire le bruit
4. √âtiquetez la s√©v√©rit√© et adaptez le type de notification dans Echobell
5. Prot√©gez l'URL du webhook ; faites-la pivoter si expos√©e

## D√©pannage

- V√©rifiez l'URL du webhook ou l'email du canal
- Assurez-vous que le canal est actif et a des abonn√©s
- Consultez les logs d'Alertmanager
- Confirmez que la route d'alertmanager.yml pointe vers le bon r√©cepteur
- Testez avec une r√®gle simple
- Si email, validez SMTP et la d√©livrabilit√©

## Confidentialit√©

- Le contenu des notifications reste sur vos appareils
- Seules des donn√©es de configuration minimales sont stock√©es c√¥t√© serveur
- Traitez les URLs de webhook et emails de canal comme des secrets
- Echobell ne conserve pas vos charges d'alerte sur ses serveurs

## Ressources

- [Documentation Prometheus](https://prometheus.io/docs/introduction/overview/)
- [Configuration Alertmanager](https://prometheus.io/docs/alerting/latest/configuration/)
- [R√®gles d'alerte](https://prometheus.io/docs/alerting/latest/alerting_rules/)
- [Webhook Echobell](/fr/docs/webhook)
- [Mod√®les](/fr/docs/notification)
- [Conditions & Lien](/fr/docs/conditions)
- [Support](/fr/docs/support)
