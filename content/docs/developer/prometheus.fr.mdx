---
title: Int√©gration Prometheus
description: Configurez Prometheus Alertmanager pour envoyer des alertes √† Echobell via webhook ou email
---

import { Step, Steps } from "fumadocs-ui/components/steps";

# Int√©gration Prometheus

Prometheus avec Alertmanager est un stack de monitoring et d'alerting open-source largement utilis√©. En int√©grant Alertmanager avec Echobell, vous pouvez recevoir des notifications mobiles instantan√©es (y compris des alertes sensibles au temps ou de type appel) chaque fois que vos r√®gles d'alerte se d√©clenchent.

## Pr√©requis

- Un compte Echobell avec au moins un canal cr√©√©
- Une installation Prometheus + Alertmanager en fonctionnement
- Acc√®s pour modifier votre configuration Alertmanager (alertmanager.yml)

## Aper√ßu

1. Cr√©er un canal Echobell
2. Configurer les mod√®les de notification
3. Choisir une m√©thode d'int√©gration (Webhook ou Email)
4. Cr√©er ou mettre √† jour les r√®gles d'alerte
5. Tester et affiner

## Guide √âtape par √âtape

<Steps>
<Step>
### Cr√©er un Canal Echobell

1. Ouvrir l'application Echobell
2. Cr√©er un nouveau canal (ex. "Alertes Prometheus")
3. Choisir une couleur pour une identification facile
</Step>
<Step>

### Configurer les Mod√®les de Notification

Le payload webhook d'Alertmanager contient des champs structur√©s comme status, commonLabels, commonAnnotations, externalURL et un tableau alerts.

**Mod√®le de Titre :**

```
{{commonLabels.alertname}} - {{status}}
```

**Mod√®le de Corps :**

```
üîî Alerte : {{commonLabels.alertname}}
üìä S√©v√©rit√© : {{commonLabels.severity}}
üñ•Ô∏è Instance : {{alerts[0].labels["instance"]}}
‚è∞ D√©but : {{alerts[0].startsAt}}
‚ÑπÔ∏è R√©sum√© : {{commonAnnotations.summary}}
```

**Mod√®le de Lien Optionnel (Param√®tres Avanc√©s) :**

```
{{alerts[0].generatorURL || externalURL}}
```

</Step>
<Step>
### M√©thode A ‚Äî Webhook (Recommand√©e)

1. Dans votre canal Echobell, copiez l'URL Webhook depuis D√©clencheurs
2. Dans Alertmanager, configurez un r√©cepteur webhook :

```yaml
route:
  receiver: echobell-webhook

receivers:
  - name: echobell-webhook
    webhook_configs:
      - url: "https://hook.echobell.one/t/REPLACE_WITH_YOUR_TOKEN"
        send_resolved: true
        http_config:
          follow_redirects: true
```

Note : `send_resolved: true` notifiera aussi quand les alertes sont r√©solues.

</Step>
<Step>
### M√©thode B ‚Äî Email (Alternative)

Si vous pr√©f√©rez l'email, utilisez le r√©cepteur email d'Alertmanager :

1. Dans Echobell, copiez l'adresse email du canal depuis D√©clencheurs
2. Configurez un r√©cepteur email dans Alertmanager :

```yaml
receivers:
  - name: echobell-email
    email_configs:
      - to: "PASTE_CHANNEL_EMAIL_ADDRESS"
        send_resolved: true
        subject: "{{ .CommonLabels.alertname }} - {{ .Status }}"
        html: |
          <p><strong>R√©sum√© :</strong> {{ .CommonAnnotations.summary }}</p>
          <p>{{ .CommonAnnotations.description }}</p>
```

</Step>
<Step>
### Cr√©er une R√®gle d'Alerte Exemple

```yaml
groups:
  - name: example
    rules:
      - alert: HighCPU
        expr: avg(rate(process_cpu_seconds_total[5m])) > 0.8
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "Utilisation CPU √©lev√©e"
          description: "CPU sup√©rieur √† 80% depuis 2 minutes"
```

Une fois cette alerte d√©clench√©e, Alertmanager enverra l'√©v√©nement √† Echobell.

</Step>
</Steps>

## Types de Notification

- **Sensible au temps** : Pannes critiques de production, incidents de niveau paging
- **Appel** : Pannes s√©v√®res n√©cessitant d'interrompre les modes focus
- **Normal** : Alertes routini√®res, avertissements ou avis informatifs

## Meilleures Pratiques

1. Garder les mod√®les concis mais informatifs
2. Utiliser le mod√®le de lien pour acc√©der directement au graphique/tableau de bord
3. Grouper et router les alertes dans Alertmanager
4. Prot√©ger l'URL webhook comme un secret

## D√©pannage

Si les alertes n'apparaissent pas dans Echobell :

- V√©rifier l'URL webhook ou l'email du canal
- S'assurer que le canal est actif et a des abonn√©s
- V√©rifier les logs Alertmanager pour les erreurs de livraison
- V√©rifier la route dans alertmanager.yml

## Ressources Suppl√©mentaires

- [Documentation Prometheus](https://prometheus.io/docs/introduction/overview/)
- [Configuration Alertmanager](https://prometheus.io/docs/alerting/latest/configuration/)
- [Webhook Echobell](/fr/docs/webhook)
- [Mod√®les de Notification](/fr/docs/notification)
