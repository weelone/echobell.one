---
title: Prometheus Alertmanager é›†æˆ - æœåŠ¡å™¨å’ŒåŸºç¡€è®¾æ–½ç›‘æ§é€šçŸ¥
sidebarTitle: Prometheus
description: å°† Prometheus Alertmanager ä¸ Echobell é›†æˆä»¥è·å–å³æ—¶ç§»åŠ¨è­¦æŠ¥çš„å®Œæ•´æŒ‡å—ã€‚é€šè¿‡ Webhook æˆ–ç”µå­é‚®ä»¶æ¥æ”¶æœåŠ¡å™¨ç›‘æ§ã€åŸºç¡€è®¾æ–½è­¦æŠ¥ã€CPU/å†…å­˜ä½¿ç”¨ç‡è­¦å‘Šå’Œå…³é”®ç³»ç»Ÿäº‹ä»¶çš„æ¨é€é€šçŸ¥ã€‚
---

import { Step, Steps } from "fumadocs-ui/components/steps";

# Prometheus é›†æˆ

Prometheus é…åˆ Alertmanager æ˜¯å¹¿æ³›ä½¿ç”¨çš„å¼€æºç›‘æ§å’Œå‘Šè­¦æ ˆã€‚å°† Alertmanager ä¸ Echobell é›†æˆåï¼Œæ¯å½“å‘Šè­¦è§„åˆ™è§¦å‘æ—¶ï¼Œæ‚¨å¯ä»¥æ”¶åˆ°å³æ—¶ç§»åŠ¨é€šçŸ¥ï¼ˆåŒ…æ‹¬æ—¶æ•ˆæ€§é€šçŸ¥æˆ–ç”µè¯é€šçŸ¥ï¼‰ã€‚

## å‰ææ¡ä»¶

- å·²åˆ›å»ºè‡³å°‘ä¸€ä¸ªé¢‘é“çš„ Echobell è´¦æˆ·
- è¿è¡Œä¸­çš„ Prometheus + Alertmanager ç¯å¢ƒ
- èƒ½å¤Ÿç¼–è¾‘ Alertmanager é…ç½®æ–‡ä»¶ï¼ˆalertmanager.ymlï¼‰

## æ¦‚è¿°

1. åˆ›å»º Echobell é¢‘é“
2. é…ç½®é€šçŸ¥æ¨¡æ¿
3. é€‰æ‹©é›†æˆæ–¹å¼ï¼ˆWebhook æˆ– Emailï¼‰
4. åˆ›å»ºæˆ–æ›´æ–°å‘Šè­¦è§„åˆ™
5. æµ‹è¯•å’Œä¼˜åŒ–

## åˆ†æ­¥æŒ‡å—

<Steps>
<Step>
### åˆ›å»º Echobell é¢‘é“

1. æ‰“å¼€ Echobell åº”ç”¨
2. åˆ›å»ºæ–°é¢‘é“ï¼ˆä¾‹å¦‚ï¼š"Prometheus å‘Šè­¦"ï¼‰
3. é€‰æ‹©ä¾¿äºè¯†åˆ«çš„é¢œè‰²
</Step>
<Step>

### é…ç½®é€šçŸ¥æ¨¡æ¿

Alertmanager çš„ Webhook è´Ÿè½½åŒ…å« statusã€commonLabelsã€commonAnnotationsã€externalURL å’Œ alerts æ•°ç»„ç­‰ç»“æ„åŒ–å­—æ®µã€‚

**æ ‡é¢˜æ¨¡æ¿ï¼š**

```
{{commonLabels.alertname}} - {{status}}
```

**æ­£æ–‡æ¨¡æ¿ï¼š**

```
ğŸ”” å‘Šè­¦ï¼š{{commonLabels.alertname}}
ğŸ“Š ä¸¥é‡çº§åˆ«ï¼š{{commonLabels.severity}}
ğŸ–¥ï¸ å®ä¾‹ï¼š{{alerts[0].labels["instance"]}}
â° å¼€å§‹æ—¶é—´ï¼š{{alerts[0].startsAt}}
â„¹ï¸ æ‘˜è¦ï¼š{{commonAnnotations.summary}}
```

**å¯é€‰é“¾æ¥æ¨¡æ¿ï¼ˆé«˜çº§è®¾ç½®ï¼‰ï¼š**

```
{{alerts[0].generatorURL || externalURL}}
```

</Step>
<Step>
### æ–¹å¼ A â€” Webhookï¼ˆæ¨èï¼‰

1. åœ¨ Echobell é¢‘é“ä¸­ï¼Œä»è§¦å‘å™¨å¤åˆ¶ Webhook URL
2. åœ¨ Alertmanager ä¸­é…ç½® Webhook æ¥æ”¶å™¨ï¼š

```yaml
route:
  receiver: echobell-webhook

receivers:
  - name: echobell-webhook
    webhook_configs:
      - url: "https://hook.echobell.one/t/REPLACE_WITH_YOUR_TOKEN"
        send_resolved: true
        http_config:
          follow_redirects: true
```

æ³¨æ„ï¼š`send_resolved: true` ä¼šåœ¨å‘Šè­¦è§£é™¤æ—¶ä¹Ÿå‘é€é€šçŸ¥ã€‚

</Step>
<Step>
### æ–¹å¼ B â€” Emailï¼ˆå¤‡é€‰ï¼‰

å¦‚æœåå¥½ä½¿ç”¨ Emailï¼Œä½¿ç”¨ Alertmanager çš„ Email æ¥æ”¶å™¨ï¼š

1. åœ¨ Echobell ä¸­ï¼Œä»è§¦å‘å™¨å¤åˆ¶é¢‘é“çš„ Email åœ°å€
2. åœ¨ Alertmanager ä¸­é…ç½® Email æ¥æ”¶å™¨ï¼š

```yaml
receivers:
  - name: echobell-email
    email_configs:
      - to: "PASTE_CHANNEL_EMAIL_ADDRESS"
        send_resolved: true
        subject: "{{ .CommonLabels.alertname }} - {{ .Status }}"
        html: |
          <p><strong>æ‘˜è¦ï¼š</strong> {{ .CommonAnnotations.summary }}</p>
          <p>{{ .CommonAnnotations.description }}</p>
```

</Step>
<Step>
### åˆ›å»ºç¤ºä¾‹å‘Šè­¦è§„åˆ™

```yaml
groups:
  - name: example
    rules:
      - alert: HighCPU
        expr: avg(rate(process_cpu_seconds_total[5m])) > 0.8
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "CPU ä½¿ç”¨ç‡è¿‡é«˜"
          description: "CPU å·²è¶…è¿‡ 80% æŒç»­ 2 åˆ†é’Ÿ"
```

å½“æ­¤å‘Šè­¦è§¦å‘æ—¶ï¼ŒAlertmanager ä¼šå°†äº‹ä»¶å‘é€åˆ° Echobellã€‚

</Step>
</Steps>

## é€šçŸ¥ç±»å‹

- **æ—¶æ•ˆæ€§**ï¼šå…³é”®ç”Ÿäº§æ•…éšœã€éœ€è¦å‘¼å«çº§åˆ«å“åº”çš„äº‹ä»¶
- **ç”µè¯**ï¼šå¿…é¡»ä¸­æ–­ä¸“æ³¨æ¨¡å¼çš„ä¸¥é‡æ•…éšœ
- **æ™®é€š**ï¼šå¸¸è§„å‘Šè­¦ã€è­¦å‘Šæˆ–ä¿¡æ¯é€šçŸ¥

## æœ€ä½³å®è·µ

1. ä¿æŒæ¨¡æ¿ç®€æ´ä½†ä¿¡æ¯å®Œæ•´
2. ä½¿ç”¨é“¾æ¥æ¨¡æ¿ç›´æ¥è·³è½¬åˆ°å›¾è¡¨/ä»ªè¡¨æ¿
3. åœ¨ Alertmanager ä¸­åˆ†ç»„å’Œè·¯ç”±å‘Šè­¦
4. å°† Webhook URL ä½œä¸ºæœºå¯†ä¿¡æ¯ä¿æŠ¤

## æ•…éšœæ’é™¤

å¦‚æœå‘Šè­¦æ²¡æœ‰å‡ºç°åœ¨ Echobell ä¸­ï¼š

- éªŒè¯ Webhook URL æˆ–é¢‘é“ Email
- ç¡®ä¿é¢‘é“å¤„äºæ´»åŠ¨çŠ¶æ€ä¸”æœ‰è®¢é˜…è€…
- æ£€æŸ¥ Alertmanager æ—¥å¿—ä¸­çš„æŠ•é€’é”™è¯¯
- éªŒè¯ alertmanager.yml ä¸­çš„è·¯ç”±

## ç›¸å…³èµ„æº

- [Prometheus æ–‡æ¡£](https://prometheus.io/docs/introduction/overview/)
- [Alertmanager é…ç½®](https://prometheus.io/docs/alerting/latest/configuration/)
- [Echobell Webhook](/zh/docs/webhook)
- [é€šçŸ¥æ¨¡æ¿](/zh/docs/notification)
